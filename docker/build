#!/bin/bash
# Consolidated build script for Skewed Emacs

set -e

cd "$(dirname "$0")"

echo "=== Building Skewed Emacs Docker Image ==="

# Get branch name for tagging
if [ -z "${CI_COMMIT_REF_NAME}" ]; then
    branch="dev"
else
    branch=${CI_COMMIT_REF_NAME//\/\//--}
fi

echo "Building with branch tag: ${branch}"

# Build the image
export DOCKER_BUILDKIT=1
docker build --progress=plain -t skewed-emacs:${branch} -f Dockerfile ..

echo ""
echo "=== Build Complete ==="
echo ""
echo "To run the container:"
echo "  ./run"
